# 实现请求日志打印功能

## 1. 技术方案
使用Spring Boot的**拦截器（Interceptor）**实现请求日志打印，拦截器可以访问HandlerMethod对象，从而获取Controller类名等信息。

## 2. 实现步骤

### 步骤1：创建请求日志拦截器
- 创建`RequestLogInterceptor`类，实现`HandlerInterceptor`接口
- 在`preHandle`方法中记录请求开始时间，获取请求基本信息
- 在`postHandle`方法中记录请求处理时间，整合所有信息
- 使用`@Slf4j`注解简化日志打印

### 步骤2：配置拦截器
- 创建`WebMvcConfig`类，实现`WebMvcConfigurer`接口
- 重写`addInterceptors`方法，将`RequestLogInterceptor`注册到拦截器链中
- 配置拦截器对所有请求生效

### 步骤3：实现请求信息获取工具方法
- 获取请求URL、IP地址
- 获取请求参数（包括GET和POST请求）
- 获取请求头信息
- 获取处理请求的Controller类名和方法名
- 处理敏感信息过滤

### 步骤4：配置日志格式
- 确保日志格式包含必要的时间戳、线程信息等
- 调整日志级别，确保请求日志能被正确打印

## 3. 核心代码设计

### 拦截器核心逻辑
```java
// 在preHandle中记录请求开始时间
request.setAttribute("startTime", System.currentTimeMillis());

// 获取请求信息
String url = request.getRequestURI();
String ip = request.getRemoteAddr();
String method = request.getMethod();

// 在postHandle中获取Controller信息
HandlerMethod handlerMethod = (HandlerMethod) handler;
String className = handlerMethod.getBeanType().getSimpleName();
String methodName = handlerMethod.getMethod().getName();

// 计算请求处理时间
long startTime = (long) request.getAttribute("startTime");
long endTime = System.currentTimeMillis();
long duration = endTime - startTime;
```

### 请求参数获取
- GET请求：通过`request.getParameterMap()`获取
- POST请求：通过`request.getReader()`读取请求体（需注意流只能读取一次的问题）

### 敏感信息过滤
对密码、token等敏感字段进行脱敏处理

## 4. 预期效果
每次请求都会在日志中打印类似以下格式的信息：
```
2024-01-16 15:30:45 [http-nio-8080-exec-1] INFO  c.e.a.interceptor.RequestLogInterceptor - 
请求信息：
URL: /admin/user/login
IP: 127.0.0.1
Method: POST
Controller: UserController.login
Headers: {User-Agent: Mozilla/5.0..., Content-Type: application/json}
Params: {username: admin, password: ******}
请求时间: 100ms
```